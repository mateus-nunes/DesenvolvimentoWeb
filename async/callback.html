<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JS Async</title>
</head>
<body>
    <h1>Consulta CEP</h1>

    <label for="cep">CEP</label>
    <input type="number" id="cep">
    <input type="text" id="nome">
    <input type="text" id="uf">
    <button id="btn_buscar">Buscar</button>

    <pre id="resultado"></pre>

    <script>

        document.getElementById("btn_buscar").onclick = function(){

            let cep = parseInt(document.getElementById("cep").value);
            
            if(typeof(cep) == "number" && cep.toString().length == 8){
                buscarCEP(cep, exibirResultado)
            }else{
                alert("CEP Inv√°lido")
            }

        }

        function buscarCEP(cep, callback){
            let req = new XMLHttpRequest();
            req.open("GET", getUrlCep(cep));

            req.onload = function(){
                if(req.status == 200){
                    callback(req.responseText)
                }else{
                    callback("Erro: " + req.status)
                }
            }

            req.send();
            
        }

        function exibirResultado(response){
            let cidade = JSON.parse(response);
            document.getElementById("uf").value = cidade.uf;
            document.getElementById("nome").value = cidade.localidade;
            document.getElementById("resultado").innerHTML = response;
        }

        function getUrlCep(cep){
            const urlDefault = "https://viacep.com.br/ws/";

            return urlDefault + cep + "/json"
        }
    </script>
</body>
</html>